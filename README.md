Проект: Система управления мобильным роботом на STM32F411

Описание проекта

Проект представляет собой систему управления мобильным роботом на базе микроконтроллера STM32F411. Система включает управление двигателями, чтение данных с гироскопа MPU6050, обработку энкодеров и реализацию PID-регулятора для поддержания курса.

Основные возможности:

    -Управление двумя моторами с помощью ШИМ

    -Интеграция с гироскопом MPU6050 для определения угла поворота

    -Обработка данных с оптических энкодеров

    -PID-регулятор для удержания курса

    -Запрограммированный маршрут движения с последовательностью поворотов

    -Калибровка гироскопа

    -Антидребезговая обработка кнопок и энкодеров


Структура файлов:
text

|── I2C.h/c           - Драйвер I2C для общения с MPU6050
|── MCU6050.h/c       - Драйвер гироскопа MPU6050
|── motor.h/c         - Управление моторами и регуляторы
|── init.h/c          - Инициализация периферии
|── handlers.h/c      - Обработчики прерываний
|── task.h/c          - Вспомогательные функции (UART)
|── main.c            - Основная программа

Конфигурация оборудования:
Используемые пины STM32F411

    PA8, PA9, PA10, PA11 - ШИМ для управления моторами (TIM1)

    PB5, PB6 - Входы энкодеров (EXTI)

    PB8, PB9 - I2C1 для MPU6050

    PA2, PA3 - UART2 для отладки

    PC13 - Кнопка пользователя

Настройки гироскопа MPU6050

    Адрес устройства: 0x68

    Диапазон гироскопа: ±250°/с

    Частота дискретизации: 1 кГц

    DLPF фильтр: 44 Гц

    Калибровка: программная компенсация смещения нуля

Параметры робота

    Диаметр колес: 67 мм

    Разрешение энкодера: 40 импульсов/оборот

    Базовый ШИМ: 380 единиц

    Максимальный ШИМ: 500 единиц


Алгоритмы управления:
PID-регулятор курса

Kp = 5.0    // Пропорциональная составляющая
Ki = 0.1    // Интегральная составляющая  
Kd = 3.0    // Дифференциальная составляющая
I_LIMIT = 20.0  // Ограничение интеграла

//PD регулятор для угла
Kp = 3.0f;
kd = 0.1f;

Управление движением

    -Движение по прямой: PID-регулятор корректирует отклонение от курса

    -Повороты: PD-регулятор для точного достижения заданного угла

    -Торможение: Плавное снижение скорости при приближении к цели

Последовательность маршрута

Робот выполняет запрограммированный маршрут из 10 шагов, каждый из которых включает:

    -Движение на заданное расстояние

    -Поворот на заданный угол

Запуск системы

    1)Нажмите кнопку пользователя (PC13) для начала калибровки

    2)Робот выполнит калибровку гироскопа (должен стоять неподвижно)

    3)После калибровки робот начнет движение по запрограммированному маршруту

    4)Для остановки/возобновления движения нажмите кнопку снова


Настройка параметров:

Основные настраиваемые параметры находятся в файле motor.h:

    MAX_PWM - максимальное значение ШИМ

    base_speed - базовая скорость движения

    PID коэффициенты: Kp, Ki, Kd

    Параметры энкодеров: WHEEL_DIAMETER_MM, ENCODER_TICKS_REV


Отладка:
Система выводит отладочную информацию через UART2 (115200 бод):

    Текущий угол и угловая скорость

    Пройденное расстояние

    Состояние выполнения маршрута
    
    Данные энкодеров

Особенности реализации:
Антидребезг

    Энкодеры: программная задержка 10 мс
    
    Кнопка: аппаратная подтяжка и проверка временного интервала

Фильтрация данных

    Гироскоп: скользящее среднее (10 отсчетов)
    
    Угловая скорость: фильтр низких частот (0.9/0.1)

Обработка прерываний

    TIM10: системный таймер (1 кГц)
    
    EXTI9_5: обработка энкодеров

    Приоритетная обработка критических секций

